#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS=hardening=+all

include /usr/share/dpkg/default.mk

CFLAGS += $(CPPFLAGS)
LDFLAGS += -Wl,--as-needed
export CFLAGS LDFLAGS

%:
	dh $@ --with python3

override_dh_auto_clean:
	python3 setup.py --verbose clean

override_dh_auto_build:
	python3 setup.py --verbose build

override_dh_auto_test: export HOME=$(CURDIR)/debian/fakehome
override_dh_auto_test:
ifeq (,$(filter nocheck,$(DEB_BUILD_OPTIONS)))
	mkdir -p "$(HOME)"
	env HOME="$(HOME)" python3 setup.py --verbose test
endif

override_dh_auto_install:
	python3 setup.py --verbose linux-package --prefix=$(CURDIR)/debian/tmp/usr

override_dh_install:
	dh_install -Xlib/kitty/terminfo

override_dh_python3:
	dh_python3 --no-ext-rename

override_dh_installchangelogs:
	dh_installchangelogs CHANGELOG.rst
